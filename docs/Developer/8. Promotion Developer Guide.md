## Promotion Exposure(Inventory) Workflow

### Promotion Exposure Sequence

Sequence to expose promotion as an inventory game is the following.

![Promotion Exposure Sequence](https://raw.githubusercontent.com/ToastAnalytics/ToastAnalytics_EN/master/docs/Developer/images/promotion_impression_sequence.png)   
[Promotion Exposure Sequence]


### Game Client Development Task

#### 1. Promotion Icon Exposure

First, call an initialization function provided in SDK and a User ID setting function.
Promotion exposure availability is needed to be checked in order to expose promotion icon, and it can be checked by calling the isPROMOTIONAvailable function.
If the isPROMOTIONAvailable function returns ‘true’, promotion exposure can take place. So, a button can be created at an appropriate location, and the route of image to use for the button can be obtained through the getPROMOTIONButtonImagePath function.
The processing about Click Event in Client should be taken care of to get the promotion board exposed in case of touching the button, and the promotion board gets exposed by calling the launchPROMOTIONPage function as Click Event occurs.

#### 2. Compensatory Processing

(No additional work is necessary, if compensatory processing regarding Analytics In App Campaign is already implemented.)
Reward is offered to users who click promotion icon with a limit of once a day.
In case of reward occurrence, SDK calls the Callback function of onMissionComplete to Client and sends Mission Key and Mission Value.
As this value is a required value in the game server for compensatory processing, be sure to send it to the game server, and as far as instructions to deliver are concerned, it can be freely implemented in the game.

>In case of mission information designated by PROMOTION, mission Key value starts with ‘*’ to distinguish it with game missions.
 
### Game Server Development Task

#### 1. Compensatory Processing


A main task of game server related to promotion is compensatory processing.
Game server should check the mission accomplishment status by calling check-mission API to PROMOTION Server in the following cases.
A case in which there is any change of factors (Level, Ranking, Number of game execution times, and other designated values in the game) related to mission setting when promotion is ongoing
A case in which previously designated mission information is received by PROMOTION (e.g. app installation mission, promotion icon clicking mission)

>In case of mission information designated by PROMOTION, mission Key value starts with ‘*’ to distinguish it with game missions.
 
When calling check-mission API to PROMOTION Server and there is reward, reward code will be received, and it should be sent to Game Client. Implement this process in the game. 
(Reward information is sent through rewardList field of response data, and it is sent only once.)

The format of mission accomplishment notification that game server should call is the following.


```json
Host: https://api-campaign-analytics.cloud.toast.com
POST /campaign/v1/server/check-mission
Content-Type: application/json

{
  "header":
  {
    "transactionId" : 92348729384729,
  },
  "userId" : "23948234",
  "appId" : "13",
  "missionKey" : "LEVEL",
  "missionValue" : 10
}
```

| Name        | Data format          | Explanation          |
|-------------|----------------|----------------|
| transactionId | int64 | This is utilized for tracking in respect of requests when logging, and it is not a necessary value. Input values here are equally set in the transactionId field of response data and returned. |
| userId | string | User unique ID provided in the game | 
| appId | String | Assigned app number at the time of app registration. [App Setting] > [Appkey] Input value. |
| missionKey | string | Key value that defines particular actions or values received through onMissionComplete(SDK). [App Setting] > [Campaign Setting] > [Mission and Reward Item Setting] Registered mission key value |
| missionValue | int64 | Value in respect of missionKey |

```json
HTTP/1.1 200 OK

{
  "header" :
  {
    "transactionId" : 92348729384729,
    "isSuccessful" : "false",
    "resultcode" : 9001,
    "resultMessages" : ["Invalid input parameter.", "..."],
    "serviceCode" : 10
  },
  "rewardList" : [
    {
      "campaignId" : 7,
      "promoDateBegin" : "2014-10-10 00:00:00",
      "promoDateEnd" : "2014-10-11 00:00:00",
      "rewardDateBegin" : "2014-10-10 00:00:00",
      "rewardDateEnd" : "2014-10-12 00:00:00",
      "rewardCode" : "gem",
      "rewardValue" : 100
    },
    ...
  ]
}
```

| Name   | Data format    | Explanation |
|--------|----------|---------|
| transactionId | int64 | Equally set transactionId received at the time of request. |
| isSuccessful | string | Set the performance success status. (Success: "true", Failure: "false") | 
| resultCode | int | Draw up a return code. (0 in case of success) |
| resultMessages | vector<string> | make it so that multiple return messages are defined. |
| serviceCode | int | Service code |
| campaignId | int | Campaign number with reward |
| promoDateBegin | Campaign start time (UTC+0 standard) | 
| promoDateEnd | string | Campaign finish time (UTC+0 standard) | 
| rewardDateBegin | string | Reward start time (UTC+0 standard) | 
| rewardDateEnd | string | Reward finish time (UTC+0 standard) | 
| rewardCode | string | Reward code |
| rewardValue | int | Reward value |

## Promotion Target Workflow

### Promotion Target Sequence

Promotion processing sequence as a target game is as follows.


![ Promotion Target Sequence](https://raw.githubusercontent.com/ToastAnalytics/ToastAnalytics_EN/master/docs/Developer/images/promotion_target_sequence.png)   
[Promotion Target Sequence]


### Game Client Development Task

#### Compensatory Processing

(No additional work is necessary, if compensatory processing regarding Analytics In App Campaign is already implemented.)
The tasks required in Client as Promotion object game are mission-sending and compensatory processing.
In case of reward occurrence, SDK calls the Callback function of onMissionComplete to Client and sends Mission Key and Mission Value.
As this value is a required value in the game server for compensatory processing, be sure to send it to the game server, and as far as instructions to deliver are concerned, it can be freely implemented in the game.

>In case of mission information designated by PROMOTION, mission Key value starts with ‘*’ to distinguish it with game missions.
 
### Game Server Development Task

#### Compensatory Processing

A main task of game server related to promotion is compensatory processing.
Game server should check the mission accomplishment status by calling check-mission API to PROMOTION Server in the following cases.
A case in which there is any change of factors (Level, Ranking, Number of game execution times, and other designated values in the game) related to mission setting when promotion is ongoing.
A case in which previously designated mission information is received by PROMOTION (e.g. app installation mission, promotion icon clicking mission)

>In case of mission information designated by PROMOTION, mission Key value starts with ‘*’ to distinguish it with game missions.

When calling check-mission API to PROMOTION Server and there is reward, reward code will be received, and it should be sent to Game Client. Implement this process in the game. The handling of this process is implemented in game. The API for notifying the mission accomplishment that the game server needs to call is identical to the game server reward API in the promotion exposure (inventory) workflow. 